<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kawaii Pet Tamagotchi</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- PWA Config -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffb7b2">
    <link rel="apple-touch-icon" href="assets/icon-192.png">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker registered! ğŸ˜', reg.scope))
                    .catch(err => console.log('SW registration failed ğŸ˜¢', err));
            });
        }
    </script>
</head>

<body>
    <!-- Splash Screen -->
    <div id="splash-screen" class="splash-screen">
        <div class="splash-content">
            <img src="assets/logo.png" alt="Kawaii Pet Game Logo" class="splash-logo">
            <h1 class="splash-title">Kawaii Pet Game</h1>
            <p class="splash-credits">by Cata T</p>

            <div class="auth-container">
                <input type="text" id="user-name" placeholder="Tu nombre..." class="auth-input">
                <input type="password" id="user-passkey" placeholder="Clave (PIN)..." class="auth-input" maxlength="10">
                <p class="auth-hint">Usa siempre los mismos para recuperar tu mascota âœ¨</p>
            </div>

            <button id="btn-start" class="start-btn">Â¡Empezar!</button>
        </div>
    </div>

    <div id="game-container">
        <!-- Flash Overlay -->
        <div id="flash-overlay" class="flash-overlay"></div>

        <header>
            <div class="header-top">
                <div class="level-badge">Nivel <span id="level-display">1</span></div>
                <div class="star-display">
                    <span class="star-icon">â­</span>
                    <span id="star-count">0</span>
                </div>
                <div style="display:flex; gap:10px;">
                    <button id="btn-camera" class="icon-btn" title="Tomar Foto">ğŸ“¸</button>
                    <button id="btn-album" class="icon-btn" title="Ãlbum de Fotos">ğŸ–¼ï¸</button>
                    <button id="btn-pet-picker" class="icon-btn" title="Cambiar Mascota">ğŸ¾</button>
                    <button id="btn-stickers" class="icon-btn" title="Ãlbum de Stickers">ğŸ“’</button>
                    <button id="btn-mute" class="icon-btn" title="Silenciar MÃºsica/SFX">ğŸ”Š</button>
                </div>
            </div>
            <div class="xp-bar-container">
                <div id="xp-bar" class="xp-bar-fill" style="width: 0%"></div>
            </div>
        </header>

        <main id="pet-area">
            <div class="environment-bg" id="bg-layer"></div>
            <div id="pet-character" class="pet bounce">
                <!-- Pet Image will be injected here -->
                <img src="assets/pet_idle.png" alt="Pet" id="pet-img"
                    onerror="this.src='https://placehold.co/200x200?text=Pet'">
            </div>

            <div id="status-effects">
                <!-- Floating emojis or hearts will appear here -->
            </div>
        </main>

        <section id="stats-panel">
            <div class="stat-box">
                <span class="icon">ğŸ–</span>
                <div class="bar-container">
                    <div id="hunger-bar" class="bar-fill hunger" style="width: 80%"></div>
                </div>
            </div>
            <div class="stat-box">
                <span class="icon">ğŸ’–</span>
                <div class="bar-container">
                    <div id="happiness-bar" class="bar-fill happiness" style="width: 80%"></div>
                </div>
            </div>
            <div class="stat-box">
                <span class="icon">âš¡</span>
                <div class="bar-container">
                    <div id="energy-bar" class="bar-fill energy" style="width: 80%"></div>
                </div>
            </div>
        </section>

        <nav id="controls">
            <button id="btn-feed" class="control-btn">
                <div class="btn-icon">
                    <img src="assets/icon_apple.png" alt="Feed">
                </div>
                <span>Comer</span>
            </button>
            <button id="btn-play" class="control-btn">
                <div class="btn-icon">
                    <img src="assets/icon_ball.png" alt="Play">
                </div>
                <span>Jugar</span>
            </button>
            <button id="btn-sleep" class="control-btn">
                <div class="btn-icon">
                    <img src="assets/icon_bed.png" alt="Sleep">
                </div>
                <span>Dormir</span>
            </button>
            <button id="btn-clean" class="control-btn">
                <div class="btn-icon">
                    <img src="assets/icon_soap.png" alt="Clean">
                </div>
                <span>BaÃ±ar</span>
            </button>
        </nav>
    </div>

    <!-- Daily Reward Modal -->
    <div id="daily-reward-modal" class="modal hidden">
        <div class="modal-content reward-modal" style="text-align:center;">
            <h2>Â¡Regalo Diario! ğŸ</h2>
            <div style="font-size:4rem; margin:20px 0;">ğŸ“…</div>
            <p>Â¡Gracias por volver a cuidar a tu mascota!</p>
            <div style="font-size:2rem; font-weight:bold; color:#ff6b6b; margin:10px 0;">+100 â­</div>
            <button id="btn-claim-reward" class="start-btn">Â¡Recibir!</button>
        </div>
    </div>

    <!-- Modal for Stickers -->
    <div id="sticker-modal" class="modal hidden">
        <div class="modal-content sticker-book">
            <h2>Ãlbum de Stickers</h2>
            <div id="sticker-grid" class="sticker-grid">
                <!-- Stickers injected here -->
            </div>
            <button id="sticker-close">Cerrar</button>
        </div>
    </div>

    <!-- Modal for Messages/Level Up -->
    <div id="message-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="modal-title">Â¡Nivel Completado!</h2>
            <p id="modal-msg">Tu mascota ha crecido.</p>
            <button id="modal-close">Â¡Genial!</button>
        </div>
    </div>

    <!-- Modal for Pet/Background Selection -->
    <div id="pet-picker-modal" class="modal hidden">
        <div class="modal-content customization-modal">
            <div class="modal-tabs">
                <button class="tab-btn active" data-tab="pet-tab">ğŸ¾ Mascota</button>
                <button class="tab-btn" data-tab="bg-tab">ğŸ–¼ï¸ Fondos</button>
            </div>

            <div id="pet-tab" class="tab-content active">
                <h2>Elige tu Mascota</h2>
                <div id="pet-grid" class="sticker-grid">
                    <!-- Pets injected here -->
                </div>
            </div>

            <div id="bg-tab" class="tab-content">
                <h2>Elige un Fondo</h2>
                <div id="bg-grid" class="sticker-grid">
                    <!-- Backgrounds injected here -->
                </div>
            </div>

            <button class="close-modal-btn"
                onclick="document.getElementById('pet-picker-modal').classList.add('hidden')">Cerrar</button>
        </div>
    </div>

    <!-- Minigames Menu Modal -->
    <div id="minigames-menu-modal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ® Minijuegos</h2>
            <p style="margin-bottom: 20px;">Â¡Gana XP y Estrellitas!</p>
            <div class="minigame-list">
                <button class="minigame-btn" data-game="tictactoe">
                    <span class="game-icon">
                        <img src="assets/tictactoe_icon.png" alt="Ta-te-ti"
                            style="width:100%; height:100%; object-fit:contain;">
                    </span>
                    <div>
                        <span class="game-name">Ta-te-ti</span>
                        <small style="color:#777; display:block; font-size:0.7rem;">-10 âš¡ EnergÃ­a</small>
                    </div>
                </button>
                <button class="minigame-btn" data-game="rps">
                    <span class="game-icon">
                        <img src="assets/rps_icon.png" alt="RPS" style="width:100%; height:100%; object-fit:contain;">
                    </span>
                    <div>
                        <span class="game-name">Piedra, Papel, Tijera</span>
                        <small style="color:#777; display:block; font-size:0.7rem;">-10 âš¡ EnergÃ­a</small>
                    </div>
                </button>
                <button class="minigame-btn" data-game="guess">
                    <span class="game-icon">
                        <img src="assets/guessnumber_icon.png" alt="Guess"
                            style="width:100%; height:100%; object-fit:contain;">
                    </span>
                    <div>
                        <span class="game-name">Adivina el NÃºmero</span>
                        <small style="color:#777; display:block; font-size:0.7rem;">-10 âš¡ EnergÃ­a</small>
                    </div>
                </button>
            </div>
            <button id="minigames-close" class="close-modal-btn">Cerrar</button>
        </div>
    </div>

    <!-- Active Game Modal -->
    <div id="active-game-modal" class="modal hidden">
        <div class="modal-content game-canvas">
            <div class="game-header">
                <h3 id="game-title">Juego</h3>
                <button id="game-exit" style="background:none;border:none;font-size:1.2rem;cursor:pointer;">âŒ</button>
            </div>
            <div id="game-area">
                <!-- Game Canvas -->
            </div>
            <div id="game-status">Â¡Tu turno!</div>
        </div>
    </div>

    <!-- Photo Album Modal -->
    <div id="photo-modal" class="modal hidden">
        <div class="modal-content">
            <h2>ğŸ“¸ Ãlbum de Fotos</h2>
            <div id="photo-grid" class="photo-grid"></div>
            <button id="photo-close">Cerrar</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>

</html>